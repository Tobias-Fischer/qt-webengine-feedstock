From 503aee5cd05076eb97ea26fc389bc3b5165e5066 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Edgar=20Andr=C3=A9s=20Margffoy=20Tuay?= <andfoy@gmail.com>
Date: Wed, 23 Feb 2022 12:34:52 -0500
Subject: [PATCH] Compile brotli for for both x86_64 and arm64 when
 cross-compiling

---
 chromium/third_party/brotli/BUILD.gn | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/chromium/third_party/brotli/BUILD.gn b/chromium/third_party/brotli/BUILD.gn
index f2c816f640e..cdb3b706303 100644
--- a/chromium/third_party/brotli/BUILD.gn
+++ b/chromium/third_party/brotli/BUILD.gn
@@ -36,6 +36,8 @@ static_library("common") {
   sources = common_sources
   public_configs = [ ":includes" ]
   deps = [ ":headers" ]
+  cflags = ["-arch", "arm64", "-arch", "x86_64"]
+  ldflags = ["-arch", "arm64", "-arch", "x86_64"]
 }
 
 static_library("common_no_dictionary_data") {
@@ -43,6 +45,8 @@ static_library("common_no_dictionary_data") {
   public_configs = [ ":includes" ]
   deps = [ ":headers" ]
   defines = [ "BROTLI_EXTERNAL_DICTIONARY_DATA" ]
+  cflags = ["-arch", "arm64", "-arch", "x86_64"]
+  ldflags = ["-arch", "arm64", "-arch", "x86_64"]
 }
 
 dec_sources = [
@@ -131,6 +135,9 @@ static_library("dec") {
   # Since we never debug brotli, freeze the optimizations to -O2.
   configs -= [ "//build/config/compiler:default_optimization" ]
   configs += [ "//build/config/compiler:optimize_max" ]
+  
+  cflags = ["-arch", "arm64", "-arch", "x86_64"]
+  ldflags = ["-arch", "arm64", "-arch", "x86_64"]
 }
 
 static_library("dec_no_dictionary_data") {
@@ -145,6 +152,9 @@ static_library("dec_no_dictionary_data") {
   # Since we never debug brotli, freeze the optimizations to -O2.
   configs -= [ "//build/config/compiler:default_optimization" ]
   configs += [ "//build/config/compiler:optimize_max" ]
+  
+  cflags = ["-arch", "arm64", "-arch", "x86_64"]
+  ldflags = ["-arch", "arm64", "-arch", "x86_64"]
 }
 
 static_library("enc") {
@@ -160,6 +170,9 @@ static_library("enc") {
   # Since we never debug brotli, freeze the optimizations to -O2.
   configs -= [ "//build/config/compiler:default_optimization" ]
   configs += [ "//build/config/compiler:optimize_max" ]
+  
+  cflags = ["-arch", "arm64", "-arch", "x86_64"]
+  ldflags = ["-arch", "arm64", "-arch", "x86_64"]
 }
 
 if (current_toolchain == host_toolchain) {
@@ -174,18 +187,23 @@ if (current_toolchain == host_toolchain) {
       ":headers",
       "//build/win:default_exe_manifest",
     ]
+    
 
     if (is_win && visual_studio_version == "2015") {
       # Disabling "result of 32-bit shift implicitly converted to 64 bits",
       # caused by code like: foo |= (1 << i);   // warning 4334
       cflags = [ "/wd4334" ]
     }
+    
 
     # Always build release since this is a build tool.
     if (is_debug) {
       configs -= [ "//build/config:debug" ]
       configs += [ "//build/config:release" ]
     }
+    
+    cflags = ["-arch", "arm64", "-arch", "x86_64"]
+    ldflags = ["-arch", "arm64", "-arch", "x86_64"]
   }
 }
 
-- 
2.25.1

